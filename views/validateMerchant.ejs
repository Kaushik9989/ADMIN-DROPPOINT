<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Dashboard — Merchant Validation</title>

  <!-- Bootstrap & Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>

  <style>
    :root{
      --nav-height: 56px;
      --sidebar-width: 250px;
      --accent: #ff7b00;
      --dark: #0b0b0b;
      --card-bg: #111;
      --muted: #777;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: 'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(135deg, #6e8efb, #a777e3); /* optional top gradient */
      -webkit-font-smoothing:antialiased;
    }

    /* Top nav (fixed) */
    .topnav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--nav-height);
      z-index: 1050;
      background: linear-gradient(90deg,#5a67d8,#6b50d6);
      display:flex;
      align-items:center;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    }
    .topnav .brand { color: #fff; font-weight:700; margin-left:16px; text-decoration:none; }

    /* Sidebar (fixed below the top nav) */
    .sidebar {
      position: fixed;
      top: var(--nav-height);
      left: 0;
      bottom: 0;
      width: var(--sidebar-width);
      padding: 20px;
      background: #fff;
      box-shadow: 2px 0 18px rgba(0,0,0,0.06);
      z-index: 1040;
      overflow:auto;
    }

    /* Main content — pushed right and down to avoid overlap */
    .main {
      margin-left: var(--sidebar-width); /* account for sidebar width */
      padding-top: calc(var(--nav-height) + 24px); /* allow space for fixed top nav */
      padding-left: 24px;
      padding-right: 24px;
      padding-bottom: 48px;
      min-height: calc(100vh - var(--nav-height));
      box-sizing: border-box;
    }

    /* Card & table styles (dark admin) */
    .panel {
      background: linear-gradient(180deg, var(--card-bg), #0f0f0f);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.45);
      color: #fff;
    }

    h2 {
      color: var(--accent);
      font-weight: 800;
      margin-bottom: 18px;
      text-align: center;
    }

    .table-dark thead th {
      background: #222;
      color: var(--accent);
      border: none;
    }
    .table-dark tbody td {
      border-color: #333;
      color: #fff;
    }

    .btn-validate {
      background: linear-gradient(145deg, var(--accent), #e86b00);
      border: none;
      color: #fff;
      font-weight: 600;
      border-radius: 8px;
      padding: 6px 14px;
    }

    .btn-disabled {
      background: #444;
      color: #bbb;
      cursor: not-allowed;
    }

    .back-btn {
      display:inline-block;
      margin-bottom: 12px;
      color: var(--accent);
      text-decoration:none;
      font-weight:700;
    }

    /* Responsive: collapse sidebar on small screens */
    @media (max-width: 900px) {
      .sidebar {
        position: static;
        width: 100%;
        height: auto;
        top: 0;
        box-shadow: none;
        display:block;
      }
      .main {
        margin-left: 0;
        padding-top: calc(var(--nav-height) + 12px);
      }
    }

    @media (max-width: 576px){
      .table-responsive { font-size: 13px; }
      .btn-validate { padding: 6px 10px; font-size: 0.92rem; }
    }
  </style>
</head>
<body>
  <!-- Top Navigation -->
  <header class="topnav d-flex align-items-center">
    <a class="brand" href="/admin/dashboard"><i class="fas fa-tools me-2"></i>Admin Panel</a>
    <div class="ms-auto me-3 d-flex align-items-center gap-2">
      <span class="text-white small">Welcome <span class="badge bg-primary">Admin</span></span>
      <a class="btn btn-outline-light btn-sm" href="/admin/logout"><i class="fas fa-sign-out-alt me-1"></i>Logout</a>
    </div>
  </header>

  <!-- Sidebar -->
  <aside class="sidebar">
    <ul class="nav flex-column">
      <li class="nav-item mb-2"><a class="nav-link text-dark" href="/admin/dashboard"><i class="fas fa-home me-2"></i>Dashboard</a></li>
      
      <li class="nav-item mb-2"><a class="nav-link text-dark" href="/admin/add-locker"><i class="fas fa-plus me-2"></i>Add Locker</a></li>
      <li class="nav-item mb-2">
      <a class="nav-link text-dark" href="/merchantValidate"><i class="fa-solid fa-users me-2"></i>Validate Merchants</a>
    </li>
      <li class="nav-item mb-2"><a class="nav-link text-dark" href="/admin/analytics"><i class="fa-solid fa-chart-line me-2"></i>Website Analytics</a></li>
      <li class="nav-item mb-2"><a class="nav-link text-dark" href="/Action_funnel"><i class="fa-solid fa-chart-line me-2"></i>Funnel Actions</a></li>
      <li class="nav-item mb-2"><a class="nav-link text-dark" href="/users"><i class="fa-solid fa-users me-2"></i>User Management</a></li>
      <li class="nav-item mb-2"><a class="nav-link text-dark" href="/admin/bookings"><i class="fas fa-list me-2"></i>All Bookings</a></li>
      <li class="nav-item mt-4"><a class="btn btn-outline-danger w-100" href="/admin/logout"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
    </ul>
  </aside>

  <!-- Main content -->
  <main class="main">
    <div class="container-fluid">
      <div class="panel">
        <a class="back-btn" href="/admin/dashboard">← Back to Dashboard</a>
        <h2>Merchant Validation</h2>

        <% if (merchants && merchants.length > 0) { %>
          <div class="table-responsive">
            <table class="table table-dark table-striped align-middle">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Organization</th>
                  <th>Name</th>
                  <th>Phone</th>
                  <th>Status</th>
                  <th>Validate</th>
                </tr>
              </thead>
              <tbody>
                <% merchants.forEach((m, index) => { %>
                  <tr>
                    <td><%= index + 1 %></td>
                    <td><%= m.organization_name || "—" %></td>
                    <td><%= m.name || "—" %></td>
                    <td><%= m.phone %></td>
                    <td>
                      <% if (m.isValid) { %>
                        <span class="badge bg-success">Validated</span>
                      <% } else { %>
                        <span class="badge bg-warning text-dark">Pending</span>
                      <% } %>
                    </td>
                    <td>
                      <% if (!m.isValid) { %>
                        <form method="POST" action="/merchantValidate/<%= m._id %>">
                          <button type="submit" class="btn-validate">✅ Validate</button>
                        </form>
                      <% } else { %>
                        <button class="btn btn-disabled" disabled>Already Validated</button>
                      <% } %>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <p class="text-center mt-4" style="color:var(--muted)">No merchants found in the database.</p>
        <% } %>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
