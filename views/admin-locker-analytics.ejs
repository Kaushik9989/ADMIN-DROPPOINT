<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Locker Analytics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: linear-gradient(135deg, #eef2ff, #fef9ff);
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
    }

    nav.sidebar {
      width: 250px;
      height: 100vh;
      position: fixed;
      top: 56px;
      left: 0;
      background: #fff;
      padding: 1rem;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
      z-index: 1040;
    }

    .main-wrapper {
  margin-left: 250px;
  padding-top: 56px;    /* same as navbar height */
  padding-left: 2rem;
  padding-right: 2rem;
  padding-bottom: 2rem;
}


    @media (max-width: 991px) {
      nav.sidebar {
        display: none;
      }
      .main-wrapper {
        margin-left: 0;
        padding: 1.5rem 1rem;
      }
    }

    .card {
      border-radius: 18px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      border: none;
    }

    .locker-card {
      cursor: pointer;
      transition: 0.2s;
      border-radius: 12px;
    }

    .locker-card:hover {
      background: #f1f5ff;
      transform: scale(1.01);
    }

    .locker-card.active {
      border: 2px solid #5a67d8;
      background: #eef2ff;
    }


@media (max-width: 991px) {
  .top-navbar {
    left: 0;
    width: 100%;
  }
}

  </style>
</head>
<body>

<!-- NAVBAR -->
<!-- NAVBAR -->
<%- include("./imports/adminTopbar") %>

<!-- SIDEBAR -->
<%- include("./imports/adminSidebar") %>

<!-- MAIN CONTENT -->
<div class="main-wrapper">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold">üìä Locker Usage Analytics</h3>
    <span class="text-muted">Click a locker to view usage</span>
  </div>

  <div class="row g-4">

    <!-- LOCKER LIST -->
    <div class="col-md-4">
      <div class="card p-3 h-100">
      <h5 class="mb-3 fw-semibold">üìç All Lockers</h5>

<input type="text"
       id="lockerSearch"
       class="form-control mb-3"
       placeholder="üîç Search by Locker ID..."
       onkeyup="filterLockers()">


<div class="list-group" id="lockerList" style="max-height: 70vh; overflow-y: auto;">

          <% lockers.forEach(l => { %>
<div class="list-group-item locker-card"
     data-lockerid="<%= l.lockerId.toLowerCase() %>"
     onclick='showChart(this, <%- JSON.stringify(l) %>)'>

              <strong><%= l.lockerId %></strong><br/>
              <small class="text-muted"><%= l.location?.address || "Unknown location" %></small>

            
            </div>
          <% }) %>
        </div>
      </div>
    </div>

    <!-- CHART -->
    <div class="col-md-8">
      <div class="card p-4 h-100">
        <h5 id="chartTitle" class="fw-semibold mb-3">Select a locker to view analytics</h5>
        <div style="height: 420px;">
          <canvas id="lockerChart"></canvas>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- SCRIPT -->
<script>
  let chartInstance = null;

  function showChart(element, locker) {
    document.querySelectorAll(".locker-card").forEach(el => el.classList.remove("active"));
    element.classList.add("active");

    const store = locker.stats?.storeClicks || 0;
    const send = locker.stats?.sendClicks || 0;
    const drop = locker.stats?.dropClicks || 0;

    document.getElementById("chartTitle").innerText =
      `üì¶ Locker ${locker.lockerId} Usage Stats`;

    const ctx = document.getElementById("lockerChart").getContext("2d");

    if (chartInstance) {
      chartInstance.destroy();
    }

// Subtle professional gradient
const gradient = ctx.createLinearGradient(0, 0, 0, 300);
gradient.addColorStop(0, "#5a67d8");
gradient.addColorStop(1, "#c3dafe");

chartInstance = new Chart(ctx, {
  type: "bar",
  data: {
    labels: ["Store", "Send", "Drop"],
    datasets: [{
      label: "Clicks",
      data: [store, send, drop],
      backgroundColor: gradient,
      borderRadius: 6,
      borderSkipped: false,
      barThickness: 36,
      maxBarThickness: 40
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    animation: {
      duration: 400
    },
    plugins: {
      legend: { display: false },
      tooltip: {
        backgroundColor: "#1f2937",
        padding: 10,
        titleFont: { size: 12 },
        bodyFont: { size: 12 }
      }
    },
    scales: {
      x: {
        grid: { display: false },
        ticks: {
          font: { size: 12 }
        }
      },
      y: {
        beginAtZero: true,
        grid: {
          color: "rgba(0,0,0,0.06)"
        },
        ticks: {
          precision: 0,
          font: { size: 11 }
        }
      }
    }
  }
});

  }
  function filterLockers() {
  const input = document.getElementById("lockerSearch").value.toLowerCase();
  const items = document.querySelectorAll("#lockerList .locker-card");

  items.forEach(item => {
    const lockerId = item.getAttribute("data-lockerid");
    if (lockerId.includes(input)) {
      item.style.display = "";
    } else {
      item.style.display = "none";
    }
  });
}

</script>

</body>
</html>